# Тестовое приложение для фильтрации текстового потока команд `cmd.exe` и консольное приложение-клиент.

## Фильтр (`filter.exe`):
- запускает процесс `cmd.exe` для выполнения команд;
- принимает от клиента посимвольно текстовый поток команд;
- выделяет из потока команды (конец команды определяется символом `'\r'` в потоке);
- фильтрует команды по черному списку на основе регулярных выражений (`regex`);
- отбрасывает команды, попадающие в черный список;
- передает команды, не попадающие в черный список, на выполнение в процесс `cmd.exe`
- передает стандартный вывод и поток ошибок от выполнения команды обратно клиенту для отображения

## Клиент (`fclient.exe`):
- посимвольно получает ввод пользователя (в свое консольное окно), каждый введенный символ отправляется фильтру;
- получает от фильтра стандартный вывод и ошибки от выполнения команды и отображает их в своем консольном окне.

## Порядок работы
Запускаем клиента. Клиент запускает фильтр, фильтр запускает `cmd.exe`. Фильтр и `cmd.exe` запускаются без создания собственных окон.
При выводе в консоль фильтр использует префикс `(filter)`, клиент - `(fclient)` для различения вывода разных процессов.
Вывод `cmd.exe` никак отдельно не маркируется.
При старте `cmd.exe` автоматически выполняется команда:
```cmd
echo cmd.exe is running
```
Соответствующая строка выведется в консоль клиента.
При работе клиент и фильтр выводят отладочные сообщения в консоль, по ним можно понять как проходят данные.
В параметре командной строки фильтра передается унаследованный handle для ввода символов.
Клиент читает консольный ввод (`ReadConsoleInput()`) по символьно и передает каждый символ фильтру.
Фильтр для чтения символов использует асинхронный ввод с помощью `ReadLine()`.
Для взаимодействия клиента и фльтра используются именованные каналы. Читающая часть канала открыта в асинхронном режиме, пишушая в синхронном.
Для взаимодействия фильтра и cmd.exe используются синхронные неименованные каналы.
Оригинальные `stdout` и `stderr` фильтр наследует у клиента (`cmd.exe` наследует у фильтра).
